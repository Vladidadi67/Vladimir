extends CharacterBody2D

# ===== PLAYER SETTINGS =====
@export var speed = 200            # horizontal movement speed
@export var jump_velocity = -400   # jump strength
@export var gravity = 900          # gravity force

# ===== OXYGEN SYSTEM =====
@export var max_oxygen = 100
var oxygen = max_oxygen
@export var oxygen_drain_speed = 5

# ===== SHIP PARTS =====
var ship_parts_collected = 0

# ===== VELOCITY =====
var velocity = Vector2.ZERO

func _physics_process(delta):
    # ---- HORIZONTAL MOVEMENT ----
    velocity.x = 0
    if Input.is_action_pressed("ui_right"):
        velocity.x += speed
    if Input.is_action_pressed("ui_left"):
        velocity.x -= speed

    # ---- GRAVITY ----
    if not is_on_floor():
        velocity.y += gravity * delta
    else:
        velocity.y = 0   # reset velocity when on floor

    # ---- JUMP ----
    if Input.is_action_just_pressed("ui_up") and is_on_floor():
        velocity.y = jump_velocity

    # ---- MOVE PLAYER ----
    velocity = move_and_slide(velocity, Vector2.UP)

func _process(delta):
    # ---- OXYGEN DRAIN ----
    oxygen -= oxygen_drain_speed * delta
    if oxygen <= 0:
        die()

func add_oxygen(amount):
    oxygen = min(oxygen + amount, max_oxygen)

func die():
    # reload current scene on death
    get_tree().reload_current_scene()
